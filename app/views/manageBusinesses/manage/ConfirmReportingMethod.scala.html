@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import views.html.layouts.unifiedLayout
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import forms.incomeSources.manage.ConfirmReportingMethodForm
@import views.html.helpers.injected.ErrorSummary
@import views.html.components._
@import uk.gov.hmrc.hmrcfrontend.views.html.components.HmrcPageHeading
@import uk.gov.hmrc.hmrcfrontend.views.viewmodels.pageheading.PageHeading
@import enums.IncomeSourceJourney.IncomeSourceType

@this(mainTemplate: unifiedLayout,
    govukButton: GovukButton,
    formWithCSRF: FormWithCSRF,
    govukWarningText : GovukWarningText,
    hmrcPageHeading: HmrcPageHeading,
    p: p,
    govukInsetText: GovukInsetText,
    govukRadios : GovukRadios,
    errorSummary: ErrorSummary
)

@(
    backUrl: String,
    postAction: Call,
    isAgent: Boolean,
    taxYearStartYear: String,
    taxYearEndYear: String,
    newReportingMethod: String,
    isCurrentTaxYear: Boolean,
    incomeSourceType: IncomeSourceType,
    form: Form[_]
)(implicit messages: Messages, user: auth.MtdItUser[_])

@prefix = @{ "manageBusinesses.manage.propertyReportingMethod" }

@getMessage(key: String, args: String*) = @{
    messages(s"$prefix.$key", args: _*)
}

@mainTemplate(pageTitle = getMessage(s"heading.$newReportingMethod"),
    backUrl = Some(backUrl),
    isAgent = isAgent,
    btaNavPartial = user.btaNavPartial) {

    @errorSummary(form)

    @hmrcPageHeading(PageHeading(
        text = getMessage(s"heading.$newReportingMethod", taxYearStartYear, taxYearEndYear),
        headingClasses = Some("govuk-heading-l"),
        section = Some(getMessage(s"subHeading.$incomeSourceType")),
        captionClasses = Some("govuk-caption-l")
    ))


    @if(newReportingMethod == "quarterly") {
        @if(isCurrentTaxYear) {
            @p(id = Some("change-reporting-method-ul-description")) {
                @getMessage("ul.description")
            }
            <ul id="change-reporting-method-ul" class="govuk-list govuk-list--bullet">
                <li id="change-reporting-method-ul-li1">@getMessage("ul.el1")</li>
                <li id="change-reporting-method-ul-li2">@getMessage("ul.el2")</li>
            </ul>
            @govukInsetText(InsetText(
                id = Some("change-reporting-method-inset"),
                content = HtmlContent(messages("manageBusinesses.manage.propertyReportingMethod.inset.quarterly"))
            ))
        }
        @if(!isCurrentTaxYear) {
            @p(id = Some("change-reporting-method-description-quarterly-CYplus")) {
                @getMessage("description.quarterly.CYplus")
            }
        }
    }
    @if(newReportingMethod == "annual") {
        @p(id = Some("change-reporting-method-description-annual")) {@getMessage("description.annual")}
        @if(isCurrentTaxYear) {
            @govukInsetText(InsetText(
                id = Some("change-reporting-method-inset"),
                content = HtmlContent(messages("manageBusinesses.manage.propertyReportingMethod.inset.annual"))
            ))
        }
    }


    @formWithCSRF(action = postAction, Symbol("id") -> "change-reporting-method-form") {

        @govukRadios(Radios(
            fieldset = Some(Fieldset(
                legend = Some(Legend(
                    content = Text(getMessage("form.heading", taxYearStartYear, taxYearEndYear)),
                    classes = "govuk-fieldset__legend govuk-fieldset__legend--m govuk-radios",
                    isPageHeading = true
                ))
            )),
            name = "change-reporting-method-check",
            items = Seq(
                RadioItem(
                    id = Some("yes-response"),
                    content = Text(messages("radioForm.yes")),
                    value = Some("Yes")
                ),
                RadioItem(
                    id = Some("no-response"),
                    content = Text(messages("radioForm.no")),
                    value = Some("No")
                )
            ),
            classes = "govuk-radios--inline",
            errorMessage = form.errors.headOption.map(err => ErrorMessage(content = Text(messages(err.message, err.args:_*))))
        ).withFormField(form("change-reporting-method-check")))

        @govukButton(Button(
            content = Text(messages("base.continue")),
            attributes = Map("id" -> "continue-button")
        ))
    }

}