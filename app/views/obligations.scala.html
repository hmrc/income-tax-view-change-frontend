@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import implicits.ImplicitDateFormatter._
@import views.html.templates.main_template
@import views.html.helpers.breadcrumbHelper
@import views.helpers.{ReportDeadlinesPage, ReportDeadlineStatusHelper}
@import views.helpers.ReportDeadlineRenderHelper.renderReportDeadlines
@import views.html.helpers.backToHomeHelper
@import views.html.helpers.accordionHelper
@import models.core.breadcrumb.{Breadcrumb, BreadcrumbItem}
@import models.reportDeadlines.ReportDeadlinesModel
@import models.reportDeadlines.QuarterlyObligation
@import models.incomeSourcesWithDeadlines.{IncomeSourcesWithDeadlinesResponse, PropertyIncomeWithDeadlinesModel}
@import models.reportDeadlines.EopsObligation
@import models.reportDeadlines.QuarterlyObligation

@(incomeSources: models.incomeSourcesWithDeadlines.IncomeSourcesWithDeadlinesModel)(implicit request: Request[_], messages: Messages, appConfig: config.FrontendAppConfig, user: auth.MtdItUser[_])

@breadcrumb = {
@breadcrumbHelper(Breadcrumb(Vector(
BreadcrumbItem("breadcrumb-it", Some(controllers.routes.HomeController.home.url)),
BreadcrumbItem("breadcrumb-obligations", None)
)), "ReportDeadlinesPage")
}

@main_template(
title = messages("obligations.title"),
bodyClasses = None,
contentHeader = Some(breadcrumb)
) {

<!--
    Heading content section
-->
<header class="page-heading">
    <h1 id="page-heading" class="heading-xlarge"> @Messages("obligations.heading.v2")</h1>
</header>

<section id="sub-heading-section">
    <h1 id="page-sub-heading" class="heading large"> @Messages("obligations.sub-heading.v2") </h1>

    <p>@Messages("obligations.sub-heading.info.prt1.v2")
        <a href="https://www.gov.uk/guidance/find-software-thats-compatible-with-making-tax-digital-for-income-tax">
            @Messages("obligations.sub-heading.info.hyperlink.v2") </a>
        @Messages("obligations.sub-heading.info.prt2.v2")
    </p>
</section>

<!--
    Quarterly returns section
-->
<h3 id="quarterlyReturns-heading" class="heading-medium">@messages("obligations.quarterlyUpdates")</h3>
<!--
    Heading and quarterly return dropdown subsection
-->

<details role="group">

    <summary id="quarterly-dropdown-title" role="button" aria-controls="details-content-0" aria-expanded="false">
        @Messages("obligation.dropdown.quarterlyReturn.info.v2")
    </summary>

    <div class="panel panel-border-narrow" id="details-content-0" aria-hidden="true">
        <p><span id="quarterly-dropdown-line1">@Messages("obligation.dropdown.quarterlyReturn.text.v2")</span> </p>

        <p><span id="quarterly-dropdown-line2">@Messages("obligation.dropdown.quarterlyReturn.text.v2.lin2.prt1")
            <a href="https://www.gov.uk/guidance/find-software-thats-compatible-with-making-tax-digital-for-income-tax">
                @Messages("obligations.sub-heading.info.hyperlink.v2") </a>
            @Messages("obligation.dropdown.quarterlyReturn.text.v2.lin2.prt2")
        </span>
        </p>
    </div>

</details>

<!--
   Property income quarterly subsection
-->

@incomeSources.propertyIncomeSource match{
case Some(propertyIncomeWithDeadlines) =>{
@propertyIncomeWithDeadlines.reportDeadlines match {
case reportDeadlines: ReportDeadlinesModel => {
@for(deadline <- reportDeadlines.currentQuarterlyDeadlines) {
<div id="pi-quarterly-return-section"  class="grid-row divider--bottom">
    <div class="row-border">
        <div class="column-half">
            <p style="font-weight:bold">
                <span id="pi-quarterly-return-title">@messages("obligations.propertyIncome")</span><br/>
                <span id="pi-quarterly-return-period" style="font-weight:normal">
                                    @{s"${deadline.start.toLongDate} ${messages("obligations.quarterly.to")} ${deadline.end.toLongDate}"}
                                </span>
            </p>
        </div>
        <div class="column-half">
            <p>
                                <span id="pi-quarterly-due-on-title">
                                    @{messages("obligations.dueOn")}
                                </span><br/>
                <span id="pi-quarterly-return-due-date" style="font-weight:normal">
                                    @{deadline.due.toLongDate}
                                </span>
            </p>
        </div>
    </div>
</div>
}
}
case _ => { }
}
}

case _ => { }

}

<!--
    Income source quarterly subsection
-->

@for(businessIncomeSource <- incomeSources.businessIncomeSources){
<section id="quarterly-business-returns">
    @businessIncomeSource.reportDeadlines match{
    case businessDeadlines: ReportDeadlinesModel => {
    @for(deadline <- businessDeadlines.currentQuarterlyDeadlines) {
    <div id="quarterlyIncomeTableRow" class="grid-row divider--bottom">
        <div class="column-half">
            <p>
            <div id="quarterly-bi-@{businessIncomeSource.incomeSource.tradingName.get}-heading" class="bold">@{businessIncomeSource.incomeSource.tradingName.get}</div>
            <div id="quarterly-bi-@{businessIncomeSource.incomeSource.tradingName.get}-period">@messages("obligations.dateToDate", deadline.start.toLongDate, deadline.end.toLongDate)</div>
            </p>
        </div>
        <div class="column-half">
            <p>
            <div id="quarterly-bi-due-on">@messages("obligations.dueOn")</div>
            <div id="quarterly-bi-@{businessIncomeSource.incomeSource.tradingName.get}-due">@{deadline.due.toLongDate}</div>
            </p>
        </div>
    </div>
    }
    }
    case _ => {}
    }
    }

</section>

<!--
    Annual updates section
-->
<h3 id="annualUpdates-heading" class="heading-medium">@messages("obligations.annualUpdates")</h3>

<!--
    Heading and annual updates dropdown subsection
-->

<details role="group">

    <summary id="annual-dropdown-title" role="button" aria-controls="details-content-1" aria-expanded="false">
        @Messages("obligation.dropdown.annualUpdates.info.v2")
    </summary>

    <div class="panel panel-border-narrow" id="details-content-1" aria-hidden="true">
        <p><span id="annual-dropdown-line1"> @Messages("obligation.dropdown.annualReturn.text.v2")</span> </p>

        <p><span id="annual-dropdown-line2">@Messages("obligation.dropdown.quarterlyReturn.text.v2.lin2.prt1")
            <a href="https://www.gov.uk/guidance/find-software-thats-compatible-with-making-tax-digital-for-income-tax">
                @Messages("obligations.sub-heading.info.hyperlink.v2") </a>
            @Messages("obligation.dropdown.annualReturn.text.v2.lin2.prt2")
        </span>
        </p>
    </div>

</details>

<!--
    Property income EOPS subsection
-->
@for(propertyIncomeSource <- incomeSources.propertyIncomeSource) {
@propertyIncomeSource.reportDeadlines match {
case propertyDeadlines: ReportDeadlinesModel => {
@for(deadline <- propertyDeadlines.currentEOPsDeadlines) {
<div id="eopsPropertyTableRow" class="grid-row divider--bottom">
    <div class="column-half">
        <p>
            <div id="eops-pi-heading" class="bold">@messages("obligations.propertyIncome")</div>
            <div id="eops-pi-dates">@messages("obligations.dateToDate", deadline.start.toLongDate, deadline.end.toLongDate)</div>
        </p>
    </div>
    <div class="column-half">
        <p>
            <div id="eops-pi-due-on">@messages("obligations.dueOn")</div>
            <div id="eops-pi-due-date">@deadline.due.toLongDate</div>
        </p>
    </div>
</div>
}
}
case _ => {}
}
}

<!--
    Income source EOPS subsection
-->
@for(businessIncomeSource <- incomeSources.businessIncomeSources){
    @businessIncomeSource.reportDeadlines match {
        case businessIncomeDeadlines: ReportDeadlinesModel => {
            @for(deadline <- businessIncomeDeadlines.currentEOPsDeadlines){
                <div id = "eopsSEIncomeSection"  class="grid-row divider--bottom">
                    <div class="column-half">
                        <p>
                        <div id="eops-SEI-@{businessIncomeSource.incomeSource.tradingName.get}-heading" class="bold">@{businessIncomeSource.incomeSource.tradingName.get}</div>
                        <div id="eops-SEI-dates">@messages("obligations.dateToDate", deadline.start.toLongDate, deadline.end.toLongDate)</div>
                        </p>
                    </div>
                    <div class="column-half">
                        <p>
                        <div id="eops-SEI-due-on">@messages("obligations.dueOn")</div>
                        <div id="eops-SEI-due-date">@deadline.due.toLongDate</div>
                        </p>
                    </div>
                </div>
            }
        }
        case _ => {}
    }
}

<!--
    Crystallised updates section
-->
<h3 id="declarations-heading" class="heading-medium">@messages("obligations.finalDeclarationUpdate")</h3>

<!--
    Heading and crystallised updates dropdown subsection
-->
<details role="group">

    <summary id="declaration-dropdown-title" role="button" aria-controls="details-content-2" aria-expanded="false">
        @Messages("obligation.dropdown.finalDeclaration.info.v2")
    </summary>

    <div class="panel panel-border-narrow" id="details-content-2" aria-hidden="true">
        <p>@Messages("obligation.dropdown.finalDeclaration.text.v2.prt1")
            <a href="https://www.gov.uk/guidance/find-software-thats-compatible-with-making-tax-digital-for-income-tax">
                @Messages("obligations.sub-heading.info.hyperlink.v2") </a>
            @Messages("obligation.dropdown.finalDeclaration.text.v2.prt2")
        </p>
    </div>

</details>

}