@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.govukfrontend.views.html.components._
@import views.html.components._
@import views.html.layouts.unifiedLayout
@import models.optin.SignUpCompletedViewModel
@import viewUtils.ExternalUrlHelper

@this(
        mainTemplate: unifiedLayout,
        h1: h1,
        h2: h2,
        p: p,
        link: link,
        hr: hr,
        govukTable: GovukTable,
        govukInsetText : GovukInsetText,
        govukPanel : GovukPanel,
        bulletList: bulletPointList,
)


@(viewModel: SignUpCompletedViewModel)(implicit messages: Messages, user: auth.MtdItUser[_], appConfig: config.FrontendAppConfig)

@getMessage(key: String, args: String*) = @{
    messages(s"signUp.completedSignUp.${viewModel.messageKey}.$key", args: _*)
}

@mainTemplate(
    pageTitle = getMessage("title"),
    isAgent = viewModel.isAgent,
    btaNavPartial = user.btaNavPartial
) {
    @govukPanel(
        Panel(
            title = Text(getMessage("heading")),
            content = Text(getMessage("heading.desc", viewModel.startYear, viewModel.endYear))
        )
    )

    @if(viewModel.isCurrentYear) {
        @govukInsetText(InsetText(id = Some("overdue-updates-inset"), content = Text(getMessage("inset", viewModel.startYear, viewModel.endYear))))
    }

    @yourRevisedDeadlines()
    @submitUpdates()

    @if(viewModel.isNextYearMandated) {
        @yourReportingObligationsNyMandated()
    } else {
        @yourReportingObligations()
    }
}

@yourRevisedDeadlines() = {
    @h2(msg = getMessage("yourRevisedDeadlines"), optId = Some("your-revised-deadlines-heading"))
    @if(!viewModel.isCurrentYear) {
        @govukInsetText(
            InsetText(content = Text(getMessage("yourRevisedDeadlines.inset")), id = Some("your-revised-deadlines-inset"))
        )
    } else {
        @p(id = Some("your-revised-deadlines-desc")) {
            @getMessage("yourRevisedDeadlines.text")
        }
    }

    @p(id = Some("your-revised-deadlines-desc-2")) {
        @getMessage("yourRevisedDeadlines.desc1.text1")
        @link(viewModel.updatesAndDeadlinesLink, messageKey = getMessage("yourRevisedDeadlines.desc1.link"), outerMessage = getMessage("yourRevisedDeadlines.desc1.comma"))
        @getMessage("yourRevisedDeadlines.desc1.text2")
    }

    @p(id = Some("your-revised-deadlines-desc-3")) {
        @getMessage("yourRevisedDeadlines.desc2.text1")
        @link(viewModel.reportingObligationsLink, messageKey = getMessage("yourRevisedDeadlines.desc2.link"))
        @getMessage("yourRevisedDeadlines.desc2.text2")
    }
}

@submitUpdates() = {
    @h2(msg = getMessage("submitUpdates"), optId = Some("submit-updates-heading"))
    @p(id = Some("submit-updates-desc")) {
        @getMessage("submitUpdates.desc1.text1")
        @link(appConfig.compatibleSoftwareLink, messageKey = getMessage("submitUpdates.desc1.link"), target=Some("_blank"), outerMessage = getMessage("submitUpdates.desc1.text3"))
        @getMessage("submitUpdates.desc1.text2")
    }

    @if(!viewModel.isCurrentYear && viewModel.isCurrentYearAnnual) {
        @p(id = Some("submit-updates-desc-2")) {
            @getMessage("submitUpdates.desc2.text1")
            @link(appConfig.selfAssessmentTaxReturn, messageKey = getMessage("submitUpdates.desc2.link"), target=Some("_blank"), outerMessage = messages("base.fullstop"))
        }
    }
}

@yourReportingObligationsNyMandated() = {
    @h2(msg = messages("signUp.completedSignUp.nyMandated.yourReportingObligations"), optId = Some("your-reporting-obligations-ny-mandated-heading"))
    @p(id = Some("your-reporting-obligations-ny-mandated-desc")) { @messages("signUp.completedSignUp.nyMandated.yourReportingObligations.desc1", viewModel.startYear, viewModel.endYear) }
    @govukInsetText(
        InsetText(content = Text(messages("signUp.completedSignUp.nyMandated.yourReportingObligations.desc2", viewModel.endYear)), id = Some("your-reporting-obligations-ny-mandated-inset"))
    )
    @p(id = Some("your-reporting-obligations-ny-mandated-desc-2")) { @messages("signUp.completedSignUp.nyMandated.yourReportingObligations.desc3") }
    @bulletList(
        itemMsgKeys =
            Seq(
                "signUp.completedSignUp.nyMandated.yourReportingObligations.bullet1",
                "signUp.completedSignUp.nyMandated.yourReportingObligations.bullet2"
            )
    )
    @p(id = Some("your-reporting-obligations-ny-mandated-desc-3")) {
        @messages("signUp.completedSignUp.nyMandated.yourReportingObligations.desc4.text1")
        @link(ExternalUrlHelper.saWhoNeedsToSignUpUrl, messageKey = messages("signUp.completedSignUp.nyMandated.yourReportingObligations.desc4.link"), target=Some("_blank"), outerMessage = messages("base.fullstop"))
    }
}

@yourReportingObligations() = {
    @h2(msg = getMessage("yourReportingObligations"), optId = Some("your-reporting-obligations-heading"))
    @p(id = Some("your-reporting-obligations-desc")) { @getMessage("yourReportingObligations.desc1", viewModel.startYear, viewModel.endYear) }
    @bulletList(
        itemMsgKeys =
            Seq(
                getMessage("yourReportingObligations.bullet1"),
                getMessage("yourReportingObligations.bullet2")
            )
    )
    @govukInsetText(
        InsetText(content = Text(getMessage("yourReportingObligations.desc2", viewModel.startYear, viewModel.endYear, viewModel.nextYear, appConfig.preThreshold2027)), id = Some("your-reporting-obligations-inset"))
    )
    @p(id = Some("your-reporting-obligations-desc-2")) { @getMessage("yourReportingObligations.desc3") }
    @p(id = Some("your-reporting-obligations-desc-3")) {
        @getMessage("yourReportingObligations.desc4.text1")
        @link(ExternalUrlHelper.saWhoNeedsToSignUpUrl, messageKey = getMessage("yourReportingObligations.desc4.link"), target=Some("_blank"), outerMessage = messages("base.fullstop"))
    }
}